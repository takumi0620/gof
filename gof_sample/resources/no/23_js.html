<html><head><title>java sample code</title><meta http-equiv="Content-Type" content="text/html; charset=x-sjis"></head><body bgcolor=#ffffff text=#000000><img src="img/00/java.gif" hspace="10"><font style="margin-left:40px"><p>使用例：<p><pre>      Cabinet cabinet = new Cabinet("PC Cabinet");      Chassis chassis = new Chassis("PC Chassis");      cabinet.add(chassis);      Bus bus = new Bus("MCA Bus");      bus->add(new Card("16Mbps Token Ring");      chassis.add(bus);      chassis.add(new FloppyDisk("3.5in Floppy"));      PricingVisitor visitor = new PricingVisitor();      cabinet.accept(visitor);      System.out.println(          "価格合計: " + visitor.getTotalPrice().toString());</pre><hr><pre>/* *  Equipment * *  役割：&lt;Component&gt;/Composite, &lt;Element&gt;/Visitor */public abstract class Equipment {    public Equipment(String name) {        _name = name;    }    String name() { return _name; }    /*     *  &lt;Component&gt;/Composite の具象サブクラスが実装する     *  インターフェース     */    public abstract Watt power();    public abstract Currency netPrice();    public abstract Currency discountPrice();    public abstract void accept(EquipmentVisitor visitor);    /*     *  &lt;Composite&gt;/Composite クラスが実装するインターフェ     *  ース     */    public void add(Equipment equipment) { }    public void remove(Equipment equipment) { }    public java.util.Enumeration createEnumeration() {         // NullEnumeration は Iterator サンプルコード(Java）         // に収録。         return new NullEnumeration();    }    /*     *  プライベートメンバ     */    private String _name;}/* *  FloppyDisk * *  役割：&lt;Leaf&gt;/Composite, &lt;ConcreteElement&gt;/Visitor */public class FloppyDisk extends Equipment {    public FloppyDisk(String name) {        super(name);        // ...    }    public Watt power() {        // ...    }    public Currency netPrice() {        // ...    }    public Currency discountPrice() {        // ...    }    public void accept(EquipmentVisitor visitor) {        visitor.visitFloppyDisk(this);    }}/* *  Card * *  役割：&lt;Leaf&gt;/Composite, &lt;ConcreteElement&gt;/Visitor */public class Card extends Equipment {    public Card(String name) {        super(name);        // ...    }    public Watt power() {        // ...    }    public Currency netPrice() {        // ...    }    public Currency discountPrice() {        // ...    }    public void accept(EquipmentVisitor visitor) {        visitor.visitCard(this);    }}import java.util.Vector;/* *  CompositeEquipment * *  役割：&lt;Composite&gt;/Composite, &lt;ObjectStructure&gt;/Visitor */public abstract class CompositeEquipment extends Equipment {    public CompositeEquipment(String name) {        super(name);        // ...    }    public Watt power() {        // ...    }    public Currency discountPrice() {        // ...    }    public void add(Equipment equipment) {        _equipment.addElement(equipment);    }    public void remove(Equipment equipment) {        _equipment.removeElement(equipment);    }    public java.util.Enumeration createEnumeration() {        // concrete iterator を作成する    }    private Vector _equipment;}/* *  Chassis * *  役割：&lt;Composite&gt;/Composite, *        &lt;ObjectStructure&gt;&lt;ConcreteElement&gt;/Visitor */public class Chassis extends CompositeEquipment {    // ...    public void accept(EquipmentVisitor visitor) {        java.util.Enumeration i = createEnumeration();        while (i.hasMoreElements()) {            ((Equipment)i.nextElement()).accept(visitor);        }        visitor.visitChassis(this);    }}/* *  Cabinet * *  役割：&lt;Composite&gt;/Composite, *        &lt;ObjectStructure&gt;&lt;ConcreteElement&gt;/Visitor */public class Cabinet extends CompositeEquipment {    // ...    public void accept(EquipmentVisitor visitor) {        java.util.Enumeration i = createEnumeration();        while (i.hasMoreElements()) {            ((Equipment)i.nextElement()).accept(visitor);        }        visitor.visitCabinet(this);    }}/* *  Bus * *  役割：&lt;Composite&gt;/Composite, *        &lt;ObjectStructure&gt;&lt;ConcreteElement&gt;/Visitor */public class Bus extends CompositeEquipment {    // ...    public void accept(EquipmentVisitor visitor) {        Enumeration i = createEnumeration();        while (i.hasMoreElements()) {            ((Equipment)i.nextElement()).accept(visitor);        }        visitor.visitBus(this);    }}// .../* *  EquipmentVisitor * *  役割：&lt;Visitor&gt; */public abstract class EquipmentVisitor {    public EquipmentVisitor() { }    public abstract void visitFloppyDisk(FloppyDisk e);    public abstract void visitCard(Card e);    public abstract void visitChassis(Chassis e);    public abstract void visitBus(Bus e);    public abstract void visitCabinet(Cabinet e);    // ... など、Equipment のすべてのサブクラスについて定義}/* *  PricingVisitor * *  役割：&lt;ConcreteVisitor&gt; */public class PricingVisitor extends EquipmentVisitor {    public PricingVisitor() { }    Currency getTotalPrice() {        return _total;    }    public void visitFloppyDisk(FloppyDisk e) {        _total.add(e.netPrice());    }    public void visitCard(Card e) {        _total.add(e.netPrice());    }    public void visitChassis(Chassis e) {        _total.add(e.discountPrice());    }    public void visitCabinet(Cabinet e) {        _total.add(e.discountPrice());    }    public void visitBus(Bus e) {        _total.add(e.discountPrice());    }    // ...    private Currency _total;}/* *  InventoryVisitor * *  役割：&lt;ConcreteVisitor&gt; */public class InventoryVisitor extends EquipmentVisitor {    public InventoryVisitor() {        // ...    }    public Inventory getInventory() {        return _inventory;    }    public void visitFloppyDisk(FloppyDisk e) {        _inventory.accumulate(e);    }    public void visitCard(Card e) {        _inventory.accumulate(e);    }    public void visitChassis(Chassis e) {        _inventory.accumulate(e);    }    public void visitCabinet(Cabinet e) {        _inventory.accumulate(e);    }    public void visitBus(Bus e) {        _inventory.accumulate(e);    }}</pre><p></font></body></html>